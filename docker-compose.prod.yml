version: "3.9"
services:
  backend:
    container_name: backend
    build:
      context: applications/backend/
      dockerfile: Dockerfile
      target: prod

    restart: always

    depends_on:
      database:
        condition: service_healthy

  frontend:
    container_name: frontend
    build:
      context: applications/frontend/
      dockerfile: Dockerfile
      target: prod

    ports:
      - "0.0.0.0:80:3000"

    restart: always

    depends_on:
      backend:
        condition: service_healthy
        restart: true

  database:
    container_name: database
    build:
      context: applications/database/
      dockerfile: Dockerfile
      target: prod

    restart: always

    volumes:
      - ./applications/database/data/prod:/var/lib/postgresql/data/pg-data
